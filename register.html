<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet"/>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:'Prompt';background:#f0f8ff;padding:20px;color:#333}
    form{max-width:600px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
    label{display:block;margin-top:12px;font-weight:bold}
    input,select{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc}
    button{margin-top:20px;padding:12px;width:100%;border:none;background:#2176bd;color:#fff;border-radius:6px;cursor:pointer}
    button:disabled{background:#ccc;cursor:not-allowed}
    .loading{display:none;text-align:center;margin-top:20px}
    .popup{display:none;text-align:center;margin:20px auto;padding:20px;background:#dff0d8;border-radius:10px}
    .popup.active{display:block}
  </style>
</head>
<body>
  <h1 style="text-align:center;">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h1>

  <form id="register-form">
    <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ *</label>
    <select name="prefix" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option><option>‡∏ô.‡∏™.</option><option>‡∏ô‡∏≤‡∏á</option><option>‡∏ô‡∏≤‡∏¢</option><option>‡∏î.‡∏ç.</option><option>‡∏î.‡∏ä.</option><option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select>
    <label>‡∏ä‡∏∑‡πà‡∏≠ *</label><input name="first_name" required/>
    <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label><input name="last_name" required/>
    <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î *</label><input type="date" name="birthdate" required/>
    <label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô *</label><input name="cid" maxlength="13" pattern="\d{13}" required/>
    <label>‡πÄ‡∏û‡∏®</label><select name="gender"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option><option>‡∏´‡∏ç‡∏¥‡∏á</option><option>‡∏ä‡∏≤‡∏¢</option><option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option></select>
    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label><input name="phone" maxlength="10" pattern="\d{10}" required/>

    <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î *</label><select name="address_province" id="province" required><option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</option></select>
    <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ *</label><select name="address_amphur" id="amphur" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô</option></select>
    <label>‡∏ï‡∏≥‡∏ö‡∏• *</label><select name="address_tambon" id="tambon" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏Å‡πà‡∏≠‡∏ô</option></select>

    <label>‡∏´‡∏°‡∏π‡πà</label><input name="address_moo"/>
    <label>‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏ñ‡∏ô‡∏ô</label><input name="address_no"/>

    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
    <label><input type="checkbox" name="is_pregnant" value="TRUE"> ‡∏´‡∏ç‡∏¥‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå</label>
    <label><input type="checkbox" name="is_postpartum" value="TRUE"> ‡∏´‡∏ç‡∏¥‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏•‡∏≠‡∏î</label>
    <label><input type="checkbox" name="is_general_user" value="TRUE"> ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</label>

    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label>
    <select name="related_to_mother_type"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option><option value="self">‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</option><option value="partner">‡πÅ‡∏ü‡∏ô</option><option value="husband">‡∏™‡∏≤‡∏°‡∏µ</option><option value="family">‡∏ç‡∏≤‡∏ï‡∏¥</option><option value="friend">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</option><option value="staff">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option><option value="other">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option></select>

    <div id="step-2" style="display:none">
      <p><strong>‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</strong><br>
      ‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô MCH Yaha Care Center ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤ ‚Ä¶ ‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ PDPA</p>
      <label><input type="checkbox" id="consent-box" name="consent" value="TRUE"/> ‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</label>
      <button type="submit" id="submit-btn" disabled>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
    </div>

    <button type="button" id="next-btn">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    <div class="loading" id="loading">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

    <input type="hidden" name="address_latitude" id="lat">
    <input type="hidden" name="address_longtitude" id="lng">
    <input type="hidden" name="updated_date" id="upd">
  </form>

  <div class="popup" id="popup">‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>

  <script>
  let lineUserId="",lineDisplayName="",linePictureUrl="";
  const prov=document.getElementById("province"),amph=document.getElementById("amphur"),tamb=document.getElementById("tambon");

  liff.init({liffId:"2007700107-rDd1AD1M"}).then(()=>liff.isLoggedIn()?liff.getProfile():liff.login()).then(p=>{
    lineUserId=p.userId;lineDisplayName=p.displayName;linePictureUrl=p.pictureUrl;
  });

  if(navigator.geolocation)navigator.geolocation.getCurrentPosition(p=>{document.getElementById("lat").value=p.coords.latitude;document.getElementById("lng").value=p.coords.longitude;});

  // Load Thailand Geo JSON
  let geoData=[];
  fetch("https://raw.githubusercontent.com/kongvut/thai-province-data/master/api_province_with_amphure_tambon.json")
    .then(r=>r.json()).then(data=>{
      geoData=data;
      prov.innerHTML="<option value=''>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>";
      [...new Set(data.map(d=>d.province))].forEach(p=>{
        let o=new Option(p,p);prov.add(o);
      });
    });

  prov.addEventListener("change",()=>{
    amph.innerHTML="<option value=''>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</option>";
    tamb.innerHTML="<option value=''>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•</option>";
    const subs=geoData.filter(d=>d.province===prov.value).map(d=>d.amphur);
    [...new Set(subs)].forEach(a=>amph.add(new Option(a,a)));
  });

  amph.addEventListener("change",()=>{
    tamb.innerHTML="<option value=''>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•</option>";
    geoData.filter(d=>d.province===prov.value&&d.amphur===amph.value).map(d=>d.tambon).forEach(t=>tamb.add(new Option(t,t)));
  });

  document.getElementById("next-btn").onclick=()=>{
    document.getElementById("step-2").style.display="block";
    document.getElementById("next-btn").style.display="none";
  };
  document.getElementById("consent-box").onchange=e=>document.getElementById("submit-btn").disabled=!e.target.checked;

  document.getElementById("register-form").onsubmit=function(e){
    e.preventDefault();
    const form=new FormData(this);
    form.append("line_user_id",lineUserId);
    form.append("line_display_name",lineDisplayName);
    form.append("line_picture_url",linePictureUrl);
    form.append("line_registered_at",new Date().toISOString());
    document.getElementById("upd").value=new Date().toISOString();

    document.getElementById("loading").style.display="block";
    fetch("https://script.google.com/macros/s/AKfycbznTaneNaGDoTwT9Xsgq9XCZDOSspbAbuqeLvkC1teurkY2PwYbk27evsmkULQWONE/exec",{method:"POST",body:form})
      .then(r=>r.json()).then(d=>{
        document.getElementById("loading").style.display="none";
        document.getElementById("popup").classList.add("active");
      });
  };
  </script>
</body>
</html>
