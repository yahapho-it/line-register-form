<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet"/>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      background-color: #f0f8ff;
      padding: 20px;
      color: #333;
    }
    form {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block; margin-top: 12px; font-weight: bold;
    }
    input, select {
      width: 100%; padding: 8px; margin-top: 4px;
      border-radius: 6px; border: 1px solid #ccc;
    }
    button {
      margin-top: 20px; padding: 12px; width: 100%;
      border: none; background-color: #2176bd;
      color: white; border-radius: 6px; font-size: 16px; cursor: pointer;
    }
    .loading { text-align: center; margin-top: 20px; display: none; }
    .popup {
      display: none; text-align: center;
      margin-top: 20px; background: #dff0d8;
      padding: 20px; border-radius: 10px;
    }
    .popup.active { display: block; }
  </style>
</head>
<body>
  <h1 style="text-align:center;">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h1>

  <form id="register-form">
    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ *</label>
    <select name="prefix" required>
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
      <option value="‡∏ô.‡∏™.">‡∏ô.‡∏™.</option>
      <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
      <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
      <option value="‡∏î.‡∏ç.">‡∏î.‡∏ç.</option>
      <option value="‡∏î.‡∏ä.">‡∏î.‡∏ä.</option>
    </select>

    <label>‡∏ä‡∏∑‡πà‡∏≠ *</label>
    <input name="first_name" required />
    <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
    <input name="last_name" required />
    <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î *</label>
    <input type="date" name="birthdate" required />
    <label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô *</label>
    <input name="cid" maxlength="13" pattern="\d{13}" required />
    <label>‡πÄ‡∏û‡∏®</label>
    <select name="gender">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
      <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
      <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
    </select>
    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label>
    <input name="phone" maxlength="10" pattern="\d{10}" required />
    <label>‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
    <input name="address_no" />
    <label>‡∏´‡∏°‡∏π‡πà</label>
    <input name="address_moo" />
    <label>‡∏ï‡∏≥‡∏ö‡∏•</label>
    <input name="address_tambon" />
    <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
    <input name="address_amphur" />
    <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
    <input name="address_province" />

    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
    <label><input type="checkbox" name="is_pregnant" value="TRUE" /> ‡∏´‡∏ç‡∏¥‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå</label>
    <label><input type="checkbox" name="is_postpartum" value="TRUE" /> ‡∏´‡∏ç‡∏¥‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏•‡∏≠‡∏î</label>
    <label><input type="checkbox" name="is_general_user" value="TRUE" /> ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</label>

    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà</label>
    <select name="related_to_mother_type">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
      <option value="self">‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</option>
      <option value="partner">‡πÅ‡∏ü‡∏ô</option>
      <option value="husband">‡∏™‡∏≤‡∏°‡∏µ</option>
      <option value="family">‡∏ç‡∏≤‡∏ï‡∏¥</option>
      <option value="friend">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</option>
      <option value="staff">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
      <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
    </select>

    <!-- ‡∏ã‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î -->
    <input type="hidden" name="address_latitude" id="lat" />
    <input type="hidden" name="address_longtitude" id="lng" />

    <button type="submit">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
    <div class="loading" id="loading">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
  </form>

  <div class="popup" id="popup">‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div>

  <script>
    let lineUserId = "", lineDisplayName = "", linePictureUrl = "";

    // Init LIFF
    liff.init({ liffId: "2007700107-rDd1AD1M" }).then(() => {
      if (!liff.isLoggedIn()) return liff.login();
      return liff.getProfile();
    }).then(profile => {
      if (!profile) return;
      lineUserId = profile.userId;
      lineDisplayName = profile.displayName;
      linePictureUrl = profile.pictureUrl;
    });

    // ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          document.getElementById("lat").value = pos.coords.latitude.toFixed(6);
          document.getElementById("lng").value = pos.coords.longitude.toFixed(6);
        },
        (err) => {
          console.warn("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î: ", err.message);
        }
      );
    }

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    document.getElementById("register-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const form = new FormData(e.target);

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LINE
      form.append("line_user_id", lineUserId);
      form.append("line_display_name", lineDisplayName);
      form.append("line_picture_url", linePictureUrl);
      form.append("line_registered_at", new Date().toISOString());

      document.getElementById("loading").style.display = "block";

      fetch("https://script.google.com/macros/s/AKfycbznTaneNaGDoTwT9Xsgq9XCZDOSspbAbuqeLvkC1teurkY2PwYbk27evsmkULQWONE/exec", {
        method: "POST", body: form
      })
      .then(r => r.json())
      .then(data => {
        document.getElementById("loading").style.display = "none";
        document.getElementById("popup").classList.add("active");
      });
    });
  </script>
</body>
</html>
